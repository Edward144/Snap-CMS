!function(e,n){"use strict";function t(n,t){for(var i,o=[],r=0;r<n.length;++r){if(!(i=a[n[r]]||function(n){for(var t=e,i=n.split(/[.\/]/),a=0;a<i.length;++a){if(!t[i[a]])return;t=t[i[a]]}return t}(n[r])))throw"module definition dependecy not found: "+n[r];o.push(i)}t.apply(null,o)}function i(e,i,o){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(i===n)throw"invalid module definition, dependencies must be specified";if(o===n)throw"invalid module definition, definition function must be specified";t(i,function(){a[e]=o.apply(null,arguments)})}var a={},o="moxman/util/Loader",r="moxman/Env",m="moxman/util/I18n",l="moxman/Loader",c="moxman/interop/TinyMcePlugin",d="moxman/interop/CkEditorPlugin";i(o,[],function(){function e(){}function n(e){document.getElementsByTagName("head")[0].appendChild(e)}var t=0,i={},a={maxLoadTime:5,load:function(e,n,t){function i(){m.length?a.loadScript(m.shift(),i,t):o()}function o(){r.length?a.loadCss(r.shift(),o,t):n()}var r=e.css||[],m=e.js||[];i()},loadScript:function(t,a,o){function r(){i[t]=!0,a()}var m,l;if(i[t])a();else{if(a=a||e,o=o||e,l=document.createElement("script"),l.type="text/javascript","object"==typeof t)for(m in t)l.setAttribute(m,t[m]);else l.src=t;"onload"in l?(l.onload=r,l.onerror=o):(l.onreadystatechange=function(){var e=l.readyState;"complete"!=e&&"loaded"!=e||r()},l.onerror=o),n(l)}},loadCss:function(o,r,m){function l(){i[o]=!0,r()}function c(){for(var e,n,t=g.styleSheets,i=t.length;i--;)if(e=t[i],(n=e.ownerNode?e.ownerNode:e.owningElement)&&n.id===s.id)return void l();(new Date).getTime()-f<1e3*a.maxLoadTime?window.setTimeout(c,0):m()}function d(){try{var e=u.sheet.cssRules;return l(),e}catch(e){}(new Date).getTime()-f<1e3*a.maxLoadTime?window.setTimeout(d,0):m()}var s,u,f,g=document;if(i[o])r();else{if(r=r||e,m=m||e,s=g.createElement("link"),s.rel="stylesheet",s.type="text/css",s.href=o,s.id="u"+t++,f=(new Date).getTime(),"onload"in s&&!function(){var e=navigator.userAgent.match(/WebKit\/(\d*)/);return!!(e&&e[1]<536)}())s.onload=l,s.onerror=m;else{if(navigator.userAgent.indexOf("Firefox")>0)return u=g.createElement("style"),u.textContent='@import "'+o+'"',d(),void n(u);c()}n(s)}}};return a}),i(r,[],function(){function e(e){return"matchMedia"in window&&matchMedia(e).matches}var n,t,i,a,o,r,m,l=navigator,c=l.userAgent;return n=/WebKit/.test(c),t=!n&&/MSIE/gi.test(c)&&/Explorer/gi.test(l.appName),t=t&&/MSIE (\w+)\./.exec(c)[1],i=-1!=c.indexOf("Mac"),a=/Android/.test(c),o=/(iPad|iPhone)/.test(c),r=e("only screen and (max-device-width: 480px)")&&(a||o),m=e("only screen and (min-width: 800px)")&&(a||o),{apiPageName:"api.php",ie:t,ie7:!("createRange"in document)&&"all"in document&&!window.opera&&!document.documentMode,mac:i,phone:r,tablet:m,desktop:!r&&!m}}),i(m,[],function(){var e=function(e){for(var n=window,t=e.split(/\//),i=0;i<t.length;++i){if(!n[t[i]])return;n=n[t[i]]}return n}("moxman/util/I18n");if(e)return e;var n={};return{add:function(e,t){for(var i in t)n[i]=t[i]},translate:function(e,t){if(void 0===e)return e;if("string"!=typeof e&&"raw"in e)return e.raw;if(e.push){var i=e.slice(1);e=(n[e[0]]||e[0]).replace(/\{([^\}]+)\}/g,function(e,n){return i[n]})}return n[e]||t||e},data:n}}),i(l,[o,r,m],function(e,n,t){function i(t){return function(i){function a(e){return m&&(m=m.replace(/^[?& ]+/,""))&&(e+=(-1===e.indexOf("?")?"?":"&")+m),e}var o,r,m=n.cacheSuffix;if(i=i||{},!n.baseUrl)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c].src;if(/(^|\/)moxman\./.test(d)){m=n.cacheSuffix||d.split("?")[1],n.baseUrl=d.substring(0,d.lastIndexOf("/"))+"/..",n.apiPageUrl=n.baseUrl+"/"+n.apiPageName;break}}if(o=i.language||n.language,moxman.ui)moxman.Dialogs[t](i);else{if(r)return;r=function(){function e(e){var n="moxman-loader-scale 0.75s "+e+" infinite cubic-bezier(.2, .68, .18, 1.08);";return"-webkit-animation: "+n+"animation: "+n}var n,t,i,a=document.createElement("div"),o=document.createElement("div"),r=document.createElement("style");a.id="moxman-modal-block",a.className="moxman-reset moxman-fade",o.className="moxman-reset moxman-loader-throbber",(r=document.createElement("style")).type="text/css";var m="keyframes moxman-loader-scale {0% {-webkit-transform: scale(1);transform: scale(1);opacity: 1;}45% {-webkit-transform: scale(0.1);transform: scale(0.1);opacity: 0.7;}80% {-webkit-transform: scale(1);transform: scale(1);opacity: 1;}}",l=".moxman-reset {margin: 0; padding: 0; border: 0; outline: 0;vertical-align: top; background: transparent;font-size: @font-size; position: static;width: auto; height: auto;white-space: nowrap; cursor: inherit;-webkit-tap-highlight-color: transparent;line-height: normal; font-weight: normal;text-align: left; float: none;-moz-box-sizing: content-box;-webkit-box-sizing: content-box;box-sizing: content-box;direction: ltr;max-width: none;}.moxman-fade {opacity: 0;filter: alpha(opacity=30);transition: opacity 0.15s linear;}.moxman-in {opacity: 0.3;}#moxman-modal-block {position: fixed;left: 0; top: 0;width: 100%; height: 100%;background: #000;}@-webkit-"+m+"@"+m+".moxman-loader-throbber {position: fixed;top: 50%; left: 50%;width: 60px; height: 60px;margin-top: -30px;margin-left: -30px;}.moxman-loader-throbber > div:nth-child(1) {"+e("-0.24s")+"}.moxman-loader-throbber > div:nth-child(2) {"+e("-0.12s")+"}.moxman-loader-throbber > div:nth-child(3) {"+e("-0s")+"}.moxman-loader-throbber > .moxman-loader-throbber-dot {background-color: #000;width: 15px;height: 15px;border-radius: 100%;margin: 2px;-webkit-animation-fill-mode: both;animation-fill-mode: both;display: inline-block;}";for(r.styleSheet?r.styleSheet.cssText=l:r.appendChild(document.createTextNode(l)),(t=document.getElementsByTagName("head")[0]).firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),a.style.zIndex=16777215,o.style.zIndex=16777215,document.body.appendChild(a),document.body.appendChild(o),i=0;i<3;i++)(n=document.createElement("div")).className="moxman-reset moxman-loader-throbber-dot",o.appendChild(n);return setTimeout(function(){a.className+=" moxman-in"},0),{hide:function(){o.parentNode.removeChild(o),r.parentNode.removeChild(r)}}}(),e.load({js:[a(n.baseUrl+"/js/moxman.api.min.js"),n.apiPageUrl+"?action=language"+(o?"&code="+o:"")],css:[a(n.baseUrl+"/skins/"+(i.skin||"lightgray")+"/skin"+(n.ie7?".ie7":"")+".min.css")]},function(){r.hide(),moxman.ui.FloatPanel.zIndex=i.zIndex||moxman.ui.FloatPanel.zIndex,moxman.Dialogs.loaded(n),moxman.Dialogs[t](i)})}}}var a=this||window;{if(!("toJSON"in Object.prototype)){var o={browse:i("browse"),upload:i("upload"),edit:i("edit"),zip:i("zip"),createDir:i("createDir"),createDoc:i("createDoc"),view:i("view"),rename:i("rename")};a.moxman=a.moxman||{};for(var r in o)a.moxman[r]=o[r];return a.moxman.addI18n=t.add,o}alert("MoxieManager detected an old prototype.js version that breaks compatibility.")}}),i(c,[l,r],function(e,n){if(!window.tinymce)return{};tinymce.PluginManager.add("moxiemanager",function(t,i){function a(e){return t.convertURL(e,null,null)}function o(e){return{mp4:"video/mp4",m4v:"video/mp4",ogv:"video/ogg",webm:"video/webm"}[e.substr(e.lastIndexOf(".")+1).toLowerCase()]}function r(e){var n={};tinymce.each(m,function(e,t){0===t.indexOf("moxiemanager_")&&(n[t.substring(13)]=e)});var t=m["moxiemanager_"+e+"_settings"];return t&&tinymce.each(t,function(e,t){t=t.replace(/moxiemanager_/g,""),n[t]=e}),n}var m=t.settings;n.baseUrl=i,n.apiPageUrl=i+"/"+n.apiPageName,n.language=m.language,n.cacheSuffix=m.cache_suffix,m.file_browser_callback=function(n,i,o,l){var c,d=t.windowManager.zIndex;tinymce.ui.FloatPanel&&(d=tinymce.ui.FloatPanel.currentZIndex),tinymce.trim(i).length>0&&(c=t.documentBaseURI.toAbsolute(i)),e.browse(tinymce.extend({zIndex:d,url:c,document_base_url:m.document_base_url,view:"image"==o||"media"==o?"thumbs":"files",multiple:!1,oninsert:function(e){var t=l.document.getElementById(n);if(t.value=a(e.focusedFile.meta.url),"createEvent"in document){var i=document.createEvent("HTMLEvents");i.initEvent("change",!1,!0),t.dispatchEvent(i)}else t.fireEvent("onchange")}},r(o)))},t.addCommand("mceInsertFile",function(){function n(e,n){return function(e,n,t){function i(e,n){var t,i;for(t=0,i=e,n=n.split(".");t<n.length;t++)i=i[n[t]];return i}return"string"!=typeof e?e(n,t):(e=""+e.replace(/\{\$([^\}]+)\}/g,function(e,a){var o,r=a.split("|"),m=i(n,r[0]);if(void 0===m)return"";for(1==r.length&&t&&t.xmlEncode&&(m=t.xmlEncode(m)),o=1;o<r.length;o++)m=t[r[o]](m,n,a);return m}),e=e.replace(/\{\=([\w]+)([^\}]+)\}/g,function(e,a,o){return i(t,a)(n,a,o)}))}(e,n,{urlencode:function(e){return encodeURIComponent(e)},xmlEncode:function(e){return tinymce.DOM.encode(e)},sizeSuffix:function(e){return-1==e?"":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"}})}var i,l=t.selection;i=l.getRng();var c=t.windowManager.zIndex;tinymce.ui.FloatPanel&&(c=tinymce.ui.FloatPanel.currentZIndex),e.browse(tinymce.extend({zIndex:c,document_base_url:m.document_base_url,oninsert:function(e){var r="";tinymce.each(e.files,function(e,m){if(l.setRng(i),m>0&&(r+=" "),/\.(gif|jpe?g|png)$/i.test(e.name))r+=n(t.getParam("moxiemanager_image_template",'<img src="{$meta.url}" width="{$meta.width}" height="{$meta.height}">'),e);else if(/\.(mp4|ogv|webm)$/i.test(e.name)){var c="<video controls>";e.meta.alt_img&&(c='<video controls poster="{$meta.alt_img}">'),e.meta.url&&(e.meta.url=a(e.meta.url),c+='<source src="{$meta.url}" type="'+o(e.meta.url)+'" />'),e.meta.alt_url&&(e.meta.alt_url=a(e.meta.alt_url),c+='<source src="{$meta.alt_url}" type="'+o(e.meta.alt_url)+'" />'),e.meta.alt_img&&(e.meta.alt_img=a(e.meta.alt_img),c+='<img src="{$meta.alt_img}" />'),c+="</video>",r+=n(t.getParam("moxiemanager_video_template",c),e)}else{if(!l.isCollapsed())return t.execCommand("mceInsertLink",e.meta.url),!1;r+=n(t.getParam("moxiemanager_file_template",'<a href="{$url}">{$name}</a>'),e)}}),l.setRng(i),t.execCommand("mceInsertContent",!1,r)}},r()))}),tinymce.Env?t.addButton("insertfile",{icon:"browse",title:"Insert file",cmd:"mceInsertFile"}):t.addButton("insertfile",{image:i+"/skins/lightgray/img/insertfile.gif",title:t.getLang("moxiemanager_insert","Insert file"),cmd:"mceInsertFile"})});var t=tinymce.settings?tinymce.settings.language:"auto";t&&"en"!=t&&tinymce.ScriptLoader.load((tinymce.PluginManager.urls.moxiemanager||tinymce.baseURL+"/plugins/moxiemanager")+"/"+n.apiPageName+"?action=language&tinymce=true&code="+t)}),i(d,[l,r],function(e,n){if(!window.CKEDITOR)return{};CKEDITOR.plugins.add("moxiemanager",{init:function(t){function i(n){return function(){var i,a,o,r;i=(n.filebrowser.target||n.filebrowser).split(":"),o={zIndex:1048575,url:(a=this.getDialog().getContentElement(i[0],i[1])).getValue(),multiple:!1,oninsert:function(e){a.setValue(e.focusedFile.meta.url)}};for(r in t.config)0===r.indexOf("moxiemanager_")&&(o[r.substr(13)]=t.config[r]);e.browse(o)}}function a(e){if(e)for(var n=0;n<e.length;n++){var t=e[n];if(!t)return;a(t.children||t.elements),t.filebrowser&&(t.onClick=i(t),t.hidden=!1)}}t.config.filebrowserBrowseUrl="/dummy",n.baseUrl=t.plugins.moxiemanager.path,n.apiPageUrl=n.baseUrl+n.apiPageName,CKEDITOR.on("dialogDefinition",function(e){a(e.data.definition.contents)})}})}),function(t){var i,o,r,m,l;for(i=0;i<t.length;i++){o=e,m=(r=t[i]).split(/[.\/]/);for(var c=0;c<m.length-1;++c)o[m[c]]===n&&(o[m[c]]={}),o=o[m[c]];o[m[m.length-1]]=a[r]}if(e.AMDLC_TESTS){l=e.privateModules||{};for(r in a)l[r]=a[r];for(i=0;i<t.length;i++)delete l[t[i]];e.privateModules=l}}([o,r,m,l,c,d])}(this);